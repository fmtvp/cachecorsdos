<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>External Site - CORS Test</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background: #ffe6e6; }
        .container { background: white; padding: 20px; border-radius: 8px; margin: 20px 0; }
        button { background: #dc3232; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #a02622; }
        .output { background: #f8f8f8; padding: 15px; border-radius: 4px; margin: 10px 0; border-left: 4px solid #dc3232; }
        .success { border-left-color: #46b450; }
    </style>
</head>
<body>
    <h1>External Site - CORS Attack Simulation</h1>
    
    <div class="container">
        <h2>Simulate Cross-Origin Request</h2>
        <p>This page simulates an external website trying to access the vulnerable API.</p>
        <p><strong>Current Origin:</strong> <span id="current-origin"></span></p>
        
        <button onclick="testVulnerableAPI()">Test Vulnerable API</button>
        <div id="test-output"></div>
    </div>

    <div class="container">
        <h2>Instructions</h2>
        <ol>
            <li>First, go to the main demo page and poison the cache</li>
            <li>Then come back to this page and click "Test Vulnerable API"</li>
            <li>You should see a CORS error if the cache was successfully poisoned</li>
        </ol>
    </div>

    <script>
        document.getElementById('current-origin').textContent = window.location.origin;

        async function testVulnerableAPI() {
            const output = document.getElementById('test-output');
            
            try {
                // Try to access the vulnerable API from this different origin
                const response = await fetch('/wp-json/wp/v2/posts?demo=poison1');
                const data = await response.json();
                const cacheStatus = response.headers.get('X-Cache') || 'unknown';
                const corsHeader = response.headers.get('Access-Control-Allow-Origin') || 'none';
                
                output.innerHTML = `
                    <div class="output success">
                        <strong>Success (Cache not poisoned):</strong><br>
                        Cache Status: ${cacheStatus}<br>
                        CORS Header: ${corsHeader}<br>
                        Posts loaded: ${data.length}<br>
                        Response received successfully
                    </div>
                `;
            } catch (error) {
                output.innerHTML = `
                    <div class="output">
                        <strong>CORS Error (Cache Poisoned!):</strong><br>
                        ${error.message}<br><br>
                        This error indicates the cache was successfully poisoned with a different origin's CORS header.
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
